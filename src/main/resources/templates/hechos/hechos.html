<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Hechos</title>

    <!-- CSS propio -->
    <link rel="stylesheet" th:href="@{/css/style.css}"/>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
<!-- HEADER -->
<header class="main-header">
    <a class="brand"
       th:href="@{/landing}"
       aria-label="MetaMapa inicio">
        <span class="brand-logo" aria-hidden="true">üó∫Ô∏è</span>
        <span class="brand-text">MetaMapa</span>
    </a>
</header>

<!-- CONTENIDO PRINCIPAL -->
<main class="content">
    <div class="title-container">
        <h2>Hechos</h2>

        <!-- Bot√≥n para alta de hecho -->
        <a class="btn-primary"
           th:href="@{/hechos/nuevo}">
            ‚ûï Agregar Hecho
        </a>
    </div>

    <!-- FILTROS -->
    <section class="filters-card">
        <!-- Pod√©s usar GET o POST, seg√∫n tu controlador -->
        <form class="filters"
              th:action="@{/hechos}"
              method="get">

            <!-- SELECT COLECCI√ìN -->
            <select name="coleccionId" style="border-radius: 6px !important;">
                <option value="">Colecci√≥n</option>
                <option th:each="coleccion : ${colecciones}"
                        th:value="${coleccion.id}"
                        th:text="${coleccion.nombre}"
                        th:selected="${coleccion.id} == ${filtroColeccionId}">
                </option>
            </select>

            <!-- BUSCAR POR NOMBRE -->
            <div class="search-box">
                <input type="text"
                       name="nombre"
                       placeholder="Nombre"
                       th:value="${filtroNombre}">
                <button type="submit" class="btn-search">üîç</button>
            </div>

            <!-- NAVEGACI√ìN -->
            <div class="checkbox-group">
                <span>Navegaci√≥n:</span>

                <label>
                    <input type="radio"
                           name="navegacion"
                           value="curada"
                           th:checked="${filtroNavegacion} == 'curada'">
                    Curada
                </label>

                <label>
                    <input type="radio"
                           name="navegacion"
                           value="irrestricta"
                           th:checked="${filtroNavegacion} == 'irrestricta'">
                    Irrestricta
                </label>
            </div>

            <!-- BOTONES -->
            <div class="buttons-group">
                <button type="submit" class="btn-primary">üîç Buscar</button>

                <!-- Limpiar filtros: redirige a /hechos sin params -->
                <a class="btn-secondary" th:href="@{/hechos}">
                    üßπ Limpiar Filtros
                </a>
            </div>
        </form>
    </section>

    <!-- MAPA -->
    <section class="map-container">
        <div id="map"></div>
    </section>
</main>

<!-- FOOTER -->
<footer class="main-footer">
    <div class="footer-container">
        <span class="footer-left">MetaMapa 2025</span>
        <a class="footer-center"
           th:href="@{/legal/privacidad}">
            Informaci√≥n legal y de privacidad
        </a>
        <span class="footer-right">Espa√±ol (AR)</span>
    </div>
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Script para el mapa con Thymeleaf inline -->
<script th:inline="javascript">
    /*<![CDATA[*/
    // Lista de hechos enviada desde el back
    // Asumo que cada hecho tiene latitud, longitud, titulo y descripcion
    var hechos = /*[[${hechos}]]*/ [];

    // Inicializar mapa
    var map = L.map('map').setView([-34.6037, -58.3816], 5); // Centro gen√©rico (Buenos Aires)

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Agregar marcadores por cada hecho
    hechos.forEach(function(hecho) {
        if (hecho.latitud != null && hecho.longitud != null) {
            L.marker([hecho.latitud, hecho.longitud])
                .addTo(map)
                .bindPopup(
                    '<strong>' + (hecho.titulo || 'Sin t√≠tulo') + '</strong><br/>' +
                    (hecho.descripcion || '')
                );
        }
    });
</script>
</body>
</html>
